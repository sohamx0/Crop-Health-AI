# ğŸŒ± Crop Health Diagnosis & Fertilizer Recommendation System

An AI-driven web application for real-time crop disease detection and fertilizer recommendations using deep learning and large language models.


## ğŸ“Œ Overview

This system detects plant diseases from leaf images using a **ResNet50 CNN model** and generates **actionable fertilizer recommendations** using the **Gemini Large Language Model (LLM)**.  
It is designed to be lightweight, fast, and usable directly by farmers via a mobile-friendly web interface.

## ğŸ“ Brief Description

**Crop Health Diagnosis & Fertilizer Recommendation System** is an intelligent agricultural solution that combines the power of deep learning computer vision with Google's advanced AI language models. The system enables farmers to instantly diagnose crop diseases by simply uploading a photo of a plant leaf. 

Using a fine-tuned ResNet50 convolutional neural network, the application accurately identifies 38 different plant diseases across multiple crop types (tomatoes, apples, corn, grapes, etc.) with 97.86% accuracy. Once a disease is detected, Google's Gemini AI generates personalized, region-specific fertilizer recommendations and treatment plans in natural language, making expert agricultural advice accessible to farmers without requiring specialized knowledge.

The solution is designed with privacy and simplicity in mindâ€”no user accounts, no data storage, and all processing happens in-memory. The lightweight architecture ensures fast inference times (200-400ms) even on standard hardware, making it practical for real-world deployment in agricultural communities.

## ğŸš€ Features

- Image-based plant disease detection (38 disease classes)
- Deep Learning using ResNet50 (TensorFlow/Keras)
- Fertilizer recommendations via Gemini LLM
- Real-time inference (200â€“400 ms on CPU)
- Flask-based REST API
- No authentication, no database, no data storage
- Privacy-first, in-memory image processing
- Robust label mapping via `class_names.json`

## ğŸ§  Tech Stack

- Python  
- Flask  
- TensorFlow / Keras  
- ResNet50 (Transfer Learning)  
- Gemini LLM  
- HTML, TailwindCSS, JavaScript

## ğŸ— System Architecture

- **Client**: Image upload + result display (Web UI)
- **Backend**: Flask API for preprocessing, inference & LLM calls
- **Model Layer**: Fine-tuned ResNet50 CNN

No database or persistent storage is used.

### Project Structure

```
Crop-Health-AI/
â”œâ”€â”€ app.py                      # Flask application & API endpoints
â”œâ”€â”€ class_names.json            # Class index â†’ label mapping (must match model output order)
â”œâ”€â”€ plant_disease_model.h5      # Pre-trained ResNet50 model
â”œâ”€â”€ wsgi.py                     # Production entrypoint (Waitress)
â”œâ”€â”€ requirements.txt            # Python dependencies
â”œâ”€â”€ requirements-dev.txt        # Dev-only deps (tests)
â”œâ”€â”€ templates/                  # HTML templates
â”‚   â”œâ”€â”€ index.html             # Main UI
â”‚   â”œâ”€â”€ library.html           # Disease library
â”‚   â””â”€â”€ vision_checker.html    # Vision checker page
â”œâ”€â”€ static/                     # Static assets (CSS, JS)
â”œâ”€â”€ assets/                     # Image assets
â””â”€â”€ .env                        # Environment variables (create this)
```

## ğŸ”¬ Model Details

- Dataset: PlantVillage
- Input size: 224 Ã— 224
- Output: Multi-class disease prediction
- Activation: Softmax

### Model Accuracy Comparison

| Model          | Accuracy |
|----------------|----------|
| EfficientNetB0 | 97.16%   |
| **ResNet50**   | 97.86%   |
| Custom CNN     | 95.84%   |
| MobileNetV2    | 93.80%   |

ResNet50 was selected for deployment due to accuracyâ€“speed balance.

## ğŸ‹ï¸ Training (Optional)

This repo expects the model output index mapping to match `class_names.json`.

- Train ResNet50 + write matching `class_names.json`:
   ```bash
   python train_resnet50_model.py
   ```
- Baseline custom CNN trainer (not ResNet50): `python train_vision_model.py`

Note: model weights (`*.h5`) and the dataset folder are intentionally ignored by git via `.gitignore`.


## ğŸŒ¾ Fertilizer Recommendation

- Generated using Gemini LLM
- Input: Crop type + predicted disease
- Output: Fertilizers, dosages, and preventive steps
- Human-readable, no rule-based logic


## ğŸ” Workflow

1. User uploads a leaf image  
2. Image sent to `/predict_disease` endpoint  
3. Image preprocessing (resize, normalize)  
4. Disease prediction via ResNet50  
5. Fertilizer advice generated by Gemini LLM  
6. Response returned as JSON  
7. Image discarded from memory  


## âš™ï¸ Installation & Setup

### Prerequisites

- Python 3.9 or higher
- Gemini API key (for fertilizer recommendations)

### Step 1: Clone the Repository

```bash
git clone https://github.com/sohamx0/Crop-Health-AI.git
cd Crop-Health-AI
```

### Step 2: Install Dependencies

```bash
pip install -r requirements.txt
```

### Step 3: Configure Gemini API Key

1. Get your Gemini API key from [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Create a `.env` file in the root directory:
   ```bash
   GEMINI_API_KEY=your_actual_api_key_here
   ```
3. The `.env` file is already in `.gitignore`, so your API key won't be committed to GitHub.

> **Note**: Disease detection will work without the API key, but fertilizer recommendations require it.

### Step 4: Run the Application

```bash
python app.py
```

The application will start on `http://127.0.0.1:5000/`

Open in your browser:
```
http://127.0.0.1:5000/
```
## ğŸ“¡ API Endpoints

- `POST /predict_disease` - Upload image and get disease prediction + fertilizer recommendation
- `GET /` - Main application interface
- `GET /library` - Disease library with sample images
- `GET /healthz` - Health check (model/class names/API key status)

## ğŸ”§ Configuration (Environment Variables)

- `GEMINI_API_KEY` (optional): enables chat + image validation + fertilizer recommendations
- `DISEASE_MODEL_PATH` (optional): defaults to `plant_disease_model.h5`
- `CLASS_NAMES_PATH` (optional): defaults to `class_names.json`
- `MAX_CONTENT_LENGTH` (optional): max upload size in bytes (default 8MB)
- `FLASK_DEBUG` (optional): set to `1` for debug mode (default off)

## ğŸ­ Production Run

For a production-like server on Windows, use Waitress:

```bash
pip install -r requirements.txt
waitress-serve --listen=0.0.0.0:5000 wsgi:app
```

## ğŸ›£ Future Scope

- Weather & soil sensor integration
- Offline inference mode
- Multilingual native UI
- IoT-based monitoring
- Region-specific retraining

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## ğŸ“œ License

MIT License

## ğŸ‘¤ Author

[sohamx0](https://github.com/sohamx0)
